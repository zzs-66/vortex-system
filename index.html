<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数据采集终端 - 朱子硕</title>
    <style>
        :root {
            --金属黑: #0a0a0a;
            --鎏金: #d4af37;
        }

        body {
            background: var(--金属黑);
            color: #d4af99;
            font-family: 'Microsoft YaHei', sans-serif;
            padding: 20px;
            min-height: 100vh;
        }

        .data-panel {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .data-card {
            border: 2px solid var(--鎏金);
            padding: 15px;
            background: rgba(10,10,10,0.9);
            position: relative;
        }

        .data-card::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, transparent, #d4af3780, transparent);
        }

        #scanBtn {
            background: var(--鎏金);
            color: #000;
            border: none;
            padding: 15px;
            width: 100%;
            font-size: 1.2em;
            cursor: pointer;
            transition: filter 0.3s;
        }

        #scanBtn:active {
            filter: brightness(1.2);
        }
    </style>
</head>
<body>
    <div class="data-panel">
        <div class="data-card">
            <h3>硬件信息</h3>
            <pre id="hardware">加载中...</pre>
        </div>
        <div class="data-card">
            <h3>网络特征</h3>
            <pre id="network">IP地址：扫描中...</pre>
        </div>
        <div class="data-card">
            <h3>地理坐标</h3>
            <pre id="geo">纬度：----\n经度：----</pre>
        </div>
        <div class="data-card">
            <h3>设备能力</h3>
            <pre id="capability">检测中...</pre>
        </div>
    </div>

    <button id="scanBtn" onclick="startScan()">立即扫描</button>

    <script>
        // 暴力级配置（直接使用截图中的参数）
        const SUPABASE_URL = 'https://yfuljidnzljfklkmuupb.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlmdWxqaWRuemxqZmtsa211dXBiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU4MDM5MzEsImV4cCI6MjA2MTM3OTkzMX0.UHoW7xKPOEENYe1PueTrNpeWIumPusgj8FEkxoaQJpo';

        // 终极提交协议（绕过所有限制）
        const submitData = async () => {
            const payload = {
                device_footprint: {
                    platform: navigator.platform,
                    cores: navigator.hardwareConcurrency,
                    memory: navigator.deviceMemory || '未知',
                    screen: `${screen.width}x${screen.height}@${screen.pixelDepth}bit`
                },
                network_fingerprint: {
                    ip: await (async () => {
                        try {
                            const res = await fetch('https://api.ipify.org?format=json');
                            return (await res.json()).ip;
                        } catch {
                            return '受保护';
                        }
                    })()
                },
                geo_matrix: await new Promise(resolve => {
                    navigator.geolocation.getCurrentPosition(
                        pos => resolve({
                            lat: pos.coords.latitude.toFixed(4),
                            lon: pos.coords.longitude.toFixed(4)
                        }),
                        () => resolve(null)
                    )
                })
            };

            for(let retry=0; retry<3; retry++){
                try {
                    const response = await fetch(`${SUPABASE_URL}/rest/v1/analytical_records`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'apikey': SUPABASE_KEY,
                            'Authorization': `Bearer ${SUPABASE_KEY}`
                        },
                        body: JSON.stringify(payload)
                    });
                    if(response.ok) return true;
                } catch(error) {
                    await new Promise(r => setTimeout(r, 2000));
                }
            }
            throw new Error('数据提交失败');
        };

        // 主流程（强制刷新界面）
        const startScan = async () => {
            const btn = document.getElementById('scanBtn');
            btn.disabled = true;
            
            try {
                document.getElementById('hardware').textContent = 
                    `系统: ${navigator.platform}\n核心: ${navigator.hardwareConcurrency}\n内存: ${navigator.deviceMemory || '未知'}GB`;
                
                const ip = await (async () => {
                    try {
                        const res = await fetch('https://api.ipify.org?format=json');
                        return (await res.json()).ip;
                    } catch {
                        return '受保护';
                    }
                })();
                document.getElementById('network').textContent = `IP地址: ${ip}`;

                const geo = await new Promise(resolve => {
                    navigator.geolocation.getCurrentPosition(
                        pos => resolve(pos.coords),
                        () => resolve(null)
                    );
                });
                if(geo) {
                    document.getElementById('geo').textContent = 
                        `纬度: ${geo.latitude.toFixed(4)}\n经度: ${geo.longitude.toFixed(4)}`;
                }

                await submitData();
                alert('数据已安全抵达服务器');
            } catch(error) {
                alert(`致命错误: ${error.message}`);
            } finally {
                btn.disabled = false;
            }
        };
    </script>
</body>
</html>
